<body>
    <!-- Add icon library -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.7.0/css/font-awesome.min.css">

    <link rel="stylesheet" type="text/css" href="styles.css">

    <script src="bower_components/webcomponentsjs/webcomponents.min.js"></script>
    <script src="https://component.kitchen/polyfills/webcomponents-lite.js"></script>

    <!--    Modal    -->
    <div id="newItemModal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <span class="close">&times;</span>
                <h2>Add Item</h2>
            </div>
            <div class="modal-body">
                <input class="modalTitle" type="text" placeholder="Title..." id="titleModalInput">
                <input class="modalDescription" type="text" placeholder="Description..." id="descriptionModalInput">
                <div class="dropdown">
                    <button onclick="modal.onColumnDropdownListClick()" class="dropbtn">Dropdown</button>
                    <div id="columnDropdownList" class="dropdown-content">
                    </div>
                </div>
            </div>
            <div class="modal-footer">
                <button class="btn danger" onclick="modal.closeModal()">Cancel</button>
                <button class="btn success" onclick="modal.addItem()">Confirm</button>
            </div>
        </div>    
    </div>

    <!--    Topnav    -->
    <div class="topnav">
        <a class="active">Trello-like</a>
        <b class="btn-group">            
            <button onclick="topnav.addColumn()" class="btn success"><span class="fa fa-plus"></span> Add Column</button>
            <button onclick="topnav.addCard()" class="btn success"><span class="fa fa-plus"></span> Add Card</button>
        </b>
        <c>
            <button onclick="topnav.filterCards()" class="btn success"><span class="fa fa-search"></span></button>
            <input type="text" placeholder="Search..." id="searchInput">
        </c>
    </div>

    <div id="rawColumns"></div>

    <div id="rawCards"></div>

    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.1.0/jquery.min.js"></script>
    <!-- <script src="js/scripts.js"></script> -->
</body>

<script>
    //TopNav Elements    
    var searchInput = document.getElementById("searchInput");

    // Modal Elements
    var modal = document.getElementById('newItemModal');
    var titleModalInput = document.getElementById('titleModalInput');
    var descriptionModalInput = document.getElementById('descriptionModalInput');
    var columnDropdownList = document.getElementById('columnDropdownList');
    var closeButton = document.getElementsByClassName("close")[0];

    // Main Page Elements
    var rawColumns = document.getElementById('rawColumns');
    var rawCards = document.getElementById('rawCards');

    var maltem = {};

    // Read Data from JSON
    $.getJSON("db.json", function(json) {
        maltem.columns = json.columns;
        maltem.cards = json.cards;
    });

    // Common Functions
    maltem.updateRaws = function(){
        rawColumns.textContent = maltem.columns;
        rawCards.textContent = maltem.cards;
    }
    maltem.refreshColumnDropdownList = function(){
        $.each(maltem.columns, function(){
            $("<a></a>")
            .attr("value", this.columnId)
            .html(this.title)
            .appendTo("#columnDropdownList");
        });
    }

    // Common Modal Functions
    modal.addItem = function() {
        var newItem = {
            title: titleModalInput.value
        }

        if(modal.mode === "COLUMN"){
            maltem.columns.push(newItem);
            console.log(maltem.columns);

        } else if(modal.mode === "CARD") {
            newItem.description = descriptionModalInput.value;
            newItem.columnId = columnDropdownList.value.id;

            maltem.cards.push(newItem);

            console.log(maltem.cards);
        }

        // Reset Modal
        titleModalInput.value = null;
        descriptionModalInput.value = null;
        columnDropdownList.value = null;


        modal.closeModal();
    }
    modal.closeModal = function(){
        maltem.updateRaws();
        modal.style.display = "none";
    }
    modal.onColumnDropdownListClick = function() {
        columnDropdownList.classList.toggle("show");
    }
    closeButton.onclick = function(event){
        modal.closeModal();
    }

    // TopNav Functions
    var topnav = {};
    topnav.addColumn = function() {
        modal.mode = "COLUMN";
        descriptionModalInput.style.display = "none";
        modal.style.display = "block";
    };
    topnav.addCard = function() {
        maltem.refreshColumnDropdownList();
        modal.mode = "CARD";
        descriptionModalInput.style.display = "inline-block";
        modal.style.display = "block";
    };
    topnav.filterCards = function() {
    }

    // Column Functions
    var columnElement = {};
    columnElement.editColumn = function(columnId, editedColumn){
        var replacements = [editedColumn];
        maltem.columns.map(obj => replacements.find(o => o.id === obj.id) || obj);
    }
    columnElement.deleteColumn = function(columnId) {
        if (maltem.columns.length > 1) {
            var removed = maltem.pop('columns');
        }
    };
    
    // Card Functions
    var cardElement = {};
    cardElement.editCard = function(cardId, editedCard){
        var replacements = [editedCard];
        maltem.cards.map(obj => replacements.find(o => o.id === obj.id) || obj);
    }
    cardElement.deleteCard = function(cardId) {
        if (maltem.cards.length > 1) {
            var removed = maltem.pop('cards');
        }
    };



    // Close the dropdown menu if the user clicks outside of it
    window.onclick = function(event) {
        if (!event.target.matches('.dropbtn')) {
            var dropdowns = document.getElementsByClassName("dropdown-content");
            var i;
            for (i = 0; i < dropdowns.length; i++) {
                var openDropdown = dropdowns[i];
                if (openDropdown.classList.contains('show')) {
                    openDropdown.classList.remove('show');
                }
            }
        }
    }

</script>